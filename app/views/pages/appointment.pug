extends ../layouts/default.pug

block content
  .container.appointment-page
    h1.page-title Запись на прием
    
    if error
      .alert.alert-danger
        p= error
    
    .appointment-form
      form(action="/appointment" method="POST")
        .row
          h3 Информация о владельце
          .col-md-6
            .form-group
              label(for="owner_name") Имя владельца *
              input.form-control#owner_name(
                type="text" 
                name="owner_name"
                value=formData.owner_name || ''
                required
              )
          .col-md-6
            .form-group
              label(for="owner_phone") Телефон владельца *
              input.form-control#owner_phone(
                type="tel" 
                name="owner_phone"
                value=formData.owner_phone || ''
                required
              )
          .col-md-6
            .form-group
              label(for="owner_email") Email владельца *
              input.form-control#owner_email(
                type="email" 
                name="owner_email"
                value=formData.owner_email || ''
                required
              )
        
        .row
          h3 Информация о питомце
          .col-md-6
            .form-group
              label(for="pet_name") Кличка питомца *
              input.form-control#pet_name(
                type="text" 
                name="pet_name"
                value=formData.pet_name || ''
                required
              )
          .col-md-6
            .form-group
              label(for="pet_type") Вид животного *
              select.form-control#pet_type(
                name="pet_type"
                required
              )
                option(value="" disabled selected) Выберите вид животного
                option(value="cat" selected=formData.pet_type === 'cat') Кошка
                option(value="dog" selected=formData.pet_type === 'dog') Собака
                option(value="bird" selected=formData.pet_type === 'bird') Птица
                option(value="fish" selected=formData.pet_type === 'fish') Рыба
                option(value="other" selected=formData.pet_type === 'other') Другое
          .col-md-6
            .form-group
              label(for="pet_age") Возраст питомца (лет) *
              input.form-control#pet_age(
                type="number" 
                name="pet_age"
                value=formData.pet_age || ''
                min="0"
                required
              )
          .col-md-6
            .form-group
              label(for="pet_breed") Порода *
              input.form-control#pet_breed(
                type="text" 
                name="pet_breed"
                value=formData.pet_breed || ''
                required
              )
          .col-md-6
            .form-group
              label(for="pet_gender") Пол животного *
              select.form-control#pet_gender(
                name="pet_gender"
                required
              )
                option(value="" disabled selected) Выберите пол
                option(value="male" selected=formData.pet_gender === 'male') Самец
                option(value="female" selected=formData.pet_gender === 'female') Самка
        
        .row
          h3 Информация о приеме
          .col-md-6
            .form-group
              label(for="vetid") Выберите ветеринара *
              select.form-control#vetid(
                name="vetid"
                required
              )
                option(value="" disabled selected) Выберите ветеринара
                each vet in vets
                  option(
                    value=vet.userid 
                    selected=formData.vetid == vet.userid
                  )= vet.name || `Ветеринар #${vet.userid}`
          .col-md-6
            .form-group
              label(for="date") Дата приема *
              input.form-control#date(
                type="date" 
                name="date"
                value=formData.date || ''
                required
                min=new Date().toISOString().split('T')[0]
              )
          .col-md-6
            .form-group
              label(for="time") Время приема *
              select.form-control#time(
                name="time"
                required
              )
                option(value="" disabled selected) Выберите время
                - let workStart = 9
                - let workEnd = 18
                if settings && settings.work_hours_start
                  - workStart = parseInt(settings.work_hours_start)
                if settings && settings.work_hours_end
                  - workEnd = parseInt(settings.work_hours_end)
                - for (let hour = workStart; hour < workEnd; hour++)
                  - for (let minute of [0, 30])
                    - const formattedHour = hour.toString().padStart(2, '0')
                    - const formattedMinute = minute.toString().padStart(2, '0')
                    - const timeString = `${formattedHour}:${formattedMinute}`
                    option(
                      value=timeString 
                      selected=formData.time === timeString
                    )= timeString
          .col-md-12
            .form-group
              label(for="comment") Причина обращения *
              textarea.form-control#comment(
                name="comment"
                rows="3"
                required
              )= formData.comment || ''
          .col-md-6
            .form-group
              label(for="type") Тип приема *
              select.form-control#type(
                name="type"
                required
              )
                option(value="" disabled selected) Выберите тип приема
                option(value="consultation" selected=formData.type === 'consultation') Консультация
                option(value="vaccination" selected=formData.type === 'vaccination') Вакцинация
                option(value="other" selected=formData.type === 'other') Другое
        
        .form-group.text-center.mt-4
          button.btn.btn-primary.btn-lg(type="submit") Записаться на прием

block scripts
  script.
    document.addEventListener('DOMContentLoaded', function() {
      // Код JavaScript для обработки формы...
    }); 